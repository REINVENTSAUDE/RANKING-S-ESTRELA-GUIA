<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Ranking Estrelas Guia</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg1:#070A12;
  --bg2:#0B1024;
  --stroke:#ffffff18;
  --txt:#eaf0ff;
  --muted:#a9b5e6;
  --gold:#ffd166;
  --silver:#cbd5e1;
  --bronze:#fb7185;
  --accent:#22d3ee;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--txt);
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:
    radial-gradient(1200px 700px at 20% 10%, #2b1a5a55, transparent 60%),
    radial-gradient(1100px 700px at 80% 30%, #0088aa44, transparent 60%),
    linear-gradient(180deg, var(--bg1), var(--bg2));
}

.wrap{
  max-width:1000px;
  margin:auto;
  padding:24px;
}

header{ margin-bottom:14px; }

.main-title{
  font-size: clamp(26px, 4vw, 40px);
  font-weight:900;
  text-transform:uppercase;
  margin:0;
}

.sub-title{
  font-size:16px;
  font-weight:800;
  color:var(--accent);
  margin-top:4px;
}

.tabbar{
  display:flex;
  gap:10px;
  margin-top:12px;
  flex-wrap:wrap;
}

.tab{
  padding:10px 14px;
  border-radius:14px;
  border:1px solid var(--stroke);
  background:#0b1130cc;
  color:var(--txt);
  font-weight:800;
  cursor:pointer;
}
.tab.active{
  border-color:var(--accent);
  box-shadow:0 0 18px #22d3ee55;
}

.board{
  border:1px solid var(--stroke);
  border-radius:20px;
  background:#0c1433cc;
  padding:16px;
}

/* TOP 3 DESKTOP */
.top3{
  display:grid;
  grid-template-columns:1fr 1.2fr 1fr;
  gap:14px;
  align-items:end;
}

.shield{
  clip-path:polygon(50% 0%,90% 15%,90% 65%,50% 100%,10% 65%,10% 15%);
  text-align:center;
  padding:22px 14px 24px;
  min-height:165px;
  position:relative;
  overflow:hidden;
  animation:fadeUp .4s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}

.shield.p1{
  background:linear-gradient(180deg,var(--gold),#b45309);
  color:#2b1900;
  transform: translateY(-18px) scale(1.05);
  z-index:2;
}
.shield.p2{
  background:linear-gradient(180deg,var(--silver),#64748b);
  color:#0f172a;
  transform: translateY(10px);
}
.shield.p3{
  background:linear-gradient(180deg,var(--bronze),#7f1d1d);
  color:#2b0000;
  transform: translateY(10px);
}

.rank{font-size:20px;font-weight:900}
.name{font-size:17px;font-weight:900;text-transform:uppercase;margin-top:6px}
.score{font-size:22px;font-weight:900;margin-top:8px}
.score span{display:block;font-size:12px;opacity:.85}

/* CAMPE√ÉO ‚Äì LUZ FORTE */
@keyframes champGlow{
  0%,100%{box-shadow:0 0 45px #ffd166cc,0 0 120px #ffd16688}
  50%{box-shadow:0 0 70px #ffd166ff,0 0 160px #ffd166aa}
}
.champion{ animation:champGlow 2.2s ease-in-out infinite; }
.champion::after{
  content:"";
  position:absolute;
  inset:-18px;
  background:radial-gradient(circle,#ffd16688 0%,transparent 70%);
  filter:blur(14px);
  z-index:-1;
}
@keyframes crownFloat{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-5px)}
}
.crown{ font-size:26px; animation:crownFloat 1.8s ease-in-out infinite; }

/* LISTA */
.list{margin-top:18px}
.row{
  display:grid;
  grid-template-columns:70px 1fr 120px;
  padding:10px;
  border-radius:12px;
}
.row:nth-child(odd){background:#0b1130aa}
.pos{font-weight:900;color:var(--muted)}
.who{font-weight:800}
.val{text-align:right;font-weight:900}

/* MOBILE */
@media (max-width:560px){
  .top3{
    grid-template-columns:1fr 1fr;
    grid-template-areas:
      "first first"
      "second third";
  }
  .top3 .p1{grid-area:first}
  .top3 .p2{grid-area:second}
  .top3 .p3{grid-area:third}
  .shield{transform:none!important}
  .row{grid-template-columns:60px 1fr 80px}
}

/* =======================
   MODO TV (tela grande)
   ======================= */
body.tv .wrap{
  max-width: none;
  width: 100vw;
  min-height: 100vh;
  padding: 3vh 4vw;
}
body.tv .board{
  border-radius: 28px;
  padding: 22px;
}
body.tv .main-title{
  font-size: clamp(36px, 3.2vw, 64px);
}
body.tv .sub-title{
  font-size: clamp(18px, 1.2vw, 26px);
}
body.tv .tab{
  padding: 14px 18px;
  font-size: 18px;
  border-radius: 16px;
}
body.tv .top3{
  gap: 18px;
}
body.tv .shield{
  min-height: 240px;
  padding: 30px 18px 34px;
}
body.tv .rank{ font-size: 28px; }
body.tv .name{ font-size: 24px; margin-top: 10px; }
body.tv .score{ font-size: 34px; margin-top: 12px; }
body.tv .score span{ font-size: 14px; }
body.tv .crown{ font-size: 34px; }

body.tv .row{
  grid-template-columns: 90px 1fr 150px;
  padding: 14px 16px;
  border-radius: 14px;
  font-size: 20px;
}
body.tv .list{ margin-top: 22px; }

/* Em TVs (16:9), segura melhor o conte√∫do */
@media (min-width: 1200px) and (min-height: 700px){
  body.tv .board{
    min-height: calc(100vh - 170px);
    display:flex;
    flex-direction:column;
  }
  body.tv .list{
    flex: 1;
    overflow:hidden;
  }
}
</style>
</head>

<body>
<div class="wrap">
<header>
  <h1 class="main-title">‚≠ê Ranking Estrelas Guia</h1>
  <div id="pageTitle" class="sub-title">Estrelas Guia</div>

  <div class="tabbar">
    <button class="tab active" data-key="estrelas_guia">Estrelas Guia</button>
    <button class="tab" data-key="guiados_estrelas">Guiados / Estrelas</button>
    <button class="tab" data-key="guiados">Guiados</button>
    <button class="tab" id="toggleAuto">‚è∏ Pausar</button>
    <button class="tab" id="toggleTv">üì∫ Modo TV</button>
  </div>
</header>

<section class="board">
  <div class="top3" id="top3"></div>
  <div class="list" id="list"></div>
</section>
</div>

<audio id="clickSound">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3">
</audio>

<script>
const DATA_FILE="dados.txt";
const tabKeys=["estrelas_guia","guiados_estrelas","guiados"];
const labels={
  estrelas_guia:"Estrelas Guia",
  guiados_estrelas:"Guiados / Estrelas",
  guiados:"Guiados"
};

let data={},active=0,auto=true;

const top3El=document.getElementById("top3");
const listEl=document.getElementById("list");
const pageTitle=document.getElementById("pageTitle");
const sound=document.getElementById("clickSound");
const toggleBtn=document.getElementById("toggleAuto");
const toggleTv=document.getElementById("toggleTv");

function parse(text){
  const out={estrelas_guia:[],guiados_estrelas:[],guiados:[]};
  const re=/(\d+\s*¬∫)\s+([A-Z√Ä-√ö0-9.\-\/ ]+?)\s+(\d+(?:[.,]\d+)?)\b/gmi;

  text.split(/\r?\n/).forEach(line=>{
    const upper=line.toUpperCase();
    if (
      upper.includes("ESTRELAS") ||
      upper.includes("GUIADOS/") ||
      upper.trim()==="GUIADOS" ||
      upper.includes("VENDEDOR") ||
      upper.includes("VIDAS")
    ) return;

    const m=[];
    let r;
    while((r=re.exec(line))!==null){
      const name=(r[2]||"").trim().replace(/\s{2,}/g," ");
      const score=Number(String(r[3]).replace(",","."));
      if(!name || !Number.isFinite(score)) continue;
      m.push({name,score});
    }
    if(m[0]) out.estrelas_guia.push(m[0]);
    if(m[1]) out.guiados_estrelas.push(m[1]);
    if(m[2]) out.guiados.push(m[2]);
  });

  Object.keys(out).forEach(k=>{
    out[k].sort((a,b)=>(b.score-a.score) || a.name.localeCompare(b.name,"pt-BR"));
  });
  return out;
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

function render(){
  const key=tabKeys[active];
  const items=data[key]||[];
  pageTitle.textContent=labels[key];

  const t=items.slice(0,3);
  const visual=[
    {i:t[1],p:2},
    {i:t[0],p:1},
    {i:t[2],p:3}
  ].filter(x=>x.i);

  top3El.innerHTML=visual.map(v=>`
    <div class="shield p${v.p} ${v.p===1?"champion":""}">
      ${v.p===1?'<div class="crown">üëë</div>':''}
      <div class="rank">${v.p}¬∫</div>
      <div class="name">${escapeHtml(v.i.name)}</div>
      <div class="score">${v.i.score}<span>vidas</span></div>
    </div>
  `).join("");

  listEl.innerHTML=items.slice(3).map((i,idx)=>`
    <div class="row">
      <div class="pos">${idx+4}¬∫</div>
      <div class="who">${escapeHtml(i.name)}</div>
      <div class="val">${i.score}</div>
    </div>
  `).join("");
}

async function load(){
  const t=await fetch(DATA_FILE+"?v="+Date.now()).then(r=>r.text());
  data=parse(t);
  render();
}

function clickSound(){
  try{
    sound.volume=.22;
    sound.currentTime=0;
    sound.play();
  }catch(e){}
}

document.querySelectorAll(".tab[data-key]").forEach((b,idx)=>{
  b.onclick=()=>{
    active=idx;
    document.querySelectorAll(".tab[data-key]").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    clickSound();
    render();
  };
});

toggleBtn.onclick=()=>{
  auto=!auto;
  toggleBtn.textContent=auto?"‚è∏ Pausar":"‚ñ∂Ô∏è Continuar";
};

toggleTv.onclick=async ()=>{
  document.body.classList.toggle("tv");
  const on=document.body.classList.contains("tv");
  toggleTv.textContent=on?"üñ• Sair TV":"üì∫ Modo TV";
  // tenta fullscreen (alguns navegadores/TVs bloqueiam se n√£o for click do usu√°rio ‚Äî aqui √© click)
  if(on){
    try{
      if(document.documentElement.requestFullscreen) await document.documentElement.requestFullscreen();
    }catch(e){}
  }else{
    try{
      if(document.fullscreenElement && document.exitFullscreen) await document.exitFullscreen();
    }catch(e){}
  }
};

setInterval(()=>{
  if(!auto) return;
  active=(active+1)%tabKeys.length;
  document.querySelectorAll(".tab[data-key]")[active].click();
},30000);

load();
</script>
</body>
</html>
